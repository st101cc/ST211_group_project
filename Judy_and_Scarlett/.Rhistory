sig.var <- c("W1wrk1aMP", 'W1condur5MP', 'W1hea2MP', 'W1NoldBroHS', 'W1hous12HH', 'W1usevcHH', 'W1hiqualdad', 'W1hiqualmum', 'W1wrkfulldad', 'W1wrkfullmum', 'W1empsmum', 'W1empsdad', 'W1ch0_2HH', 'W1ch3_11HH', 'IndSchool', 'W1marstatmum', 'W1depkids', 'W1famtyp2', 'W1nssecfam', 'W1ethgrpYP', 'W1heposs9YP', 'W1hwndayYP', 'W1truantYP', 'W1alceverYP', 'W1bulrc', 'W1disabYP', 'W2disc1YP', 'W2depressYP', 'W4AlcFreqYP', 'W4CannTryYP', 'W4NamesYP', 'W4RacismYP', 'W4empsYP','W4Childck1YP', 'W5JobYP', 'W5JobYP', 'W5EducYP', 'W5Apprent1YP', 'W6JobYP', 'W6UnivYP', 'W6EducYP', 'W6Apprent1YP', 'W6acqno', 'W6gcse', 'W6als', 'W6OwnchiDV', 'W6Childliv', 'W6NEETAct', 'W8DDEGP', 'W8TENURE', 'W2ghq12scr', 'W4schatYP', 'W6DebtattYP')
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.1 <- lm(formula_obj, data = data)
display(model.1)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = merged_data)
display(model.2)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = merged_data)
summary(model.2)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = merged_data)
display(model.2)
sig.var_3 <- c("W1hea2MP", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_3, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.3 <- lm(formula_obj, data = merged_data)
display(model.3)
sig.var_4 <- c("W1hea2MP", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_4, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.4 <- lm(formula_obj, data = merged_data)
display(model.4)
vif(model.4)
sig.var_4 <- c("W1hea2MP", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_4, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.4 <- lm(formula_obj, data = merged_data)
#display(model.4)
vif(model.4)
kept_var <- c("W1hea2MP", "W1hous12HH", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.5 <- lm(formula_obj, data = merged_data)
display(model.5)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.6 <- lm(formula_obj, data = merged_data)
display(model.6)
kept_var <- c("W1GrssyrMP", "W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.7 <- lm(formula_obj, data = merged_data)
display(model.7) # final model in this section
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.7 <- lm(formula_obj, data = merged_data)
display(model.7) # final model in this section
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.8 <- lm(formula_obj, data = merged_data)
display(model.8)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = data)
display(model.2)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = data)
summary(model.2)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = merged_data)
display(model.2)
ggplot(data=eot.dat, aes(x=factor(W1marstatmum),y=W8DINCW)) +
geom_boxplot()
eot.dat <- read.csv("../data/W8DINCW_newlevel.csv",stringsAsFactors=TRUE)
ggplot(data=eot.dat, aes(x=factor(W1marstatmum),y=W8DINCW)) +
geom_boxplot()
ggplot(data=eot.dat, aes(x=factor(W1depkids),y=W8DINCW)) +
geom_boxplot()
ggplot(data=eot.dat, aes(x=factor(W1nssecfam),y=W8DINCW)) +
geom_boxplot()
ggplot(data=eot.dat, aes(x=factor(W1ethgrpYP),y=W8DINCW)) +
geom_boxplot()
ggplot(data=eot.dat, aes(x=factor(W1hwndayYP),y=W8DINCW)) +
geom_boxplot()
merged_data <- merged_data %>%
mutate(
W1depkids = as.character(W1depkids),  # convert to character to avoid issues with factor levels
W1depkids = if_else(W1depkids %in% c("1", "2", "3"), "1_2_3", W1depkids),
W1nssecfam = as.character(W1nssecfam),
W1nssecfam = case_when(
W1nssecfam %in% c("1", "2") ~ "1_2",
W1nssecfam %in% c("3", "4", "5") ~ "3_4_5",
W1nssecfam %in% c("6", "7") ~ "6_7",
TRUE ~ as.character(W1nssecfam)
),
W1ethgrpYP = as.character(W1ethgrpYP),
W1ethgrpYP = case_when(
W1ethgrpYP %in% c("2", "3") ~ "2_3",
W1ethgrpYP %in% c("6", "7", "8") ~ "6_7_8",
TRUE ~ as.character(W1ethgrpYP)
),
W1hwndayYP = as.character(W1hwndayYP),
W1hwndayYP = if_else(W1hwndayYP %in% c("2", "3"), "2_3", W1hwndayYP)
) %>%
mutate(
# convert back to factors with new levels
W1depkids = factor(W1depkids),
W1nssecfam = factor(W1nssecfam),
W1ethgrpYP = factor(W1ethgrpYP),
W1hwndayYP = factor(W1hwndayYP)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1depkids = droplevels(W1depkids),
W1nssecfam = droplevels(W1nssecfam),
W1ethgrpYP = droplevels(W1ethgrpYP),
W1hwndayYP = droplevels(W1hwndayYP)
)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
display(model.9) # the final model in this section
summary(model.9)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
display(model.9)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
summary(model.9)
kept_var <- c("W1hea2MP", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
summary(model.9)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
summary(model.9)
merged_data <- merged_data %>%
mutate(
W1depkids = as.character(W1depkids),
W1depkids = if_else(W1depkids %in% c("1", "2", "3"), "1_2_3", W1depkids),
W1marstatmum = as.character(W1marstatmum),
W1marstatmum = if_else(W1depkids %in% c("4_5", "6"), "4_5_6", W1marstatmum),
W1nssecfam = as.character(W1nssecfam),
W1nssecfam = case_when(
W1nssecfam %in% c("1", "2") ~ "1_2",
W1nssecfam %in% c("3", "4", "5") ~ "3_4_5",
W1nssecfam %in% c("6", "7") ~ "6_7",
TRUE ~ as.character(W1nssecfam)
),
W1ethgrpYP = as.character(W1ethgrpYP),
W1ethgrpYP = case_when(
W1ethgrpYP %in% c("2", "3") ~ "2_3",
W1ethgrpYP %in% c("6", "7", "8") ~ "6_7_8",
TRUE ~ as.character(W1ethgrpYP)
),
W1hwndayYP = as.character(W1hwndayYP),
W1hwndayYP = if_else(W1hwndayYP %in% c("2", "3"), "2_3", W1hwndayYP)
) %>%
mutate(
# convert back to factors with new levels
W1depkids = factor(W1depkids),
W1marstatmum = factor(W1marstatmum),
W1nssecfam = factor(W1nssecfam),
W1ethgrpYP = factor(W1ethgrpYP),
W1hwndayYP = factor(W1hwndayYP)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1depkids = droplevels(W1depkids),
W1marstatmum = droplevels(W1marstatmum),
W1nssecfam = droplevels(W1nssecfam),
W1ethgrpYP = droplevels(W1ethgrpYP),
W1hwndayYP = droplevels(W1hwndayYP)
)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
display(model.9)
merged_data <- merged_data %>%
mutate(
W1depkids = as.character(W1depkids),
W1depkids = if_else(W1depkids %in% c("1", "2", "3"), "1_2_3", W1depkids),
W1marstatmum = as.character(W1marstatmum),
W1marstatmum = if_else(W1depkids %in% c("4_5", "6"), "4_5_6", W1marstatmum),
W1nssecfam = as.character(W1nssecfam),
W1nssecfam = case_when(
W1nssecfam %in% c("1", "2") ~ "1_2",
W1nssecfam %in% c("3", "4", "5") ~ "3_4_5",
W1nssecfam %in% c("6", "7") ~ "6_7",
TRUE ~ as.character(W1nssecfam)
),
W1ethgrpYP = as.character(W1ethgrpYP),
W1ethgrpYP = case_when(
W1ethgrpYP %in% c("2", "3") ~ "2_3",
W1ethgrpYP %in% c("6", "7", "8") ~ "6_7_8",
TRUE ~ as.character(W1ethgrpYP)
),
W1hwndayYP = as.character(W1hwndayYP),
W1hwndayYP = if_else(W1hwndayYP %in% c("2", "3"), "2_3", W1hwndayYP)
) %>%
mutate(
# convert back to factors with new levels
W1depkids = factor(W1depkids),
W1marstatmum = factor(W1marstatmum),
W1nssecfam = factor(W1nssecfam),
W1ethgrpYP = factor(W1ethgrpYP),
W1hwndayYP = factor(W1hwndayYP)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1depkids = droplevels(W1depkids),
W1marstatmum = droplevels(W1marstatmum),
W1nssecfam = droplevels(W1nssecfam),
W1ethgrpYP = droplevels(W1ethgrpYP),
W1hwndayYP = droplevels(W1hwndayYP)
)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
summary(model.9)
merged_data <- data  # create a copy for modifications
merged_data <- merged_data %>%
mutate(
#W1hous12HH, merge levels 4 and 5
W1hous12HH = as.character(W1hous12HH),  # convert to character to avoid issues with factor levels
W1hous12HH = if_else(W1hous12HH %in% c("4", "5"), "4_5", W1hous12HH),
# W1hiqualmum, merge several groups of levels
W1hiqualmum = as.character(W1hiqualmum),
W1hiqualmum = case_when(
W1hiqualmum %in% c("3", "4") ~ "3_4",
W1hiqualmum %in% c("5", "6", "7") ~ "5_6_7",
W1hiqualmum %in% c("8", "9") ~ "8_9",
W1hiqualmum %in% c("12", "13", "14") ~ "12_13_14",
TRUE ~ as.character(W1hiqualmum)
),
# for W1marstatmum, merge levels 4, 5 and 6
W1marstatmum = as.character(W1marstatmum),
W1marstatmum = if_else(W1marstatmum %in% c("4", "5", "6"), "4_5_6", W1marstatmum)
) %>%
mutate(
# convert back to factors with new levels
W1hous12HH = factor(W1hous12HH),
W1hiqualmum = factor(W1hiqualmum),
W1marstatmum = factor(W1marstatmum)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1hous12HH = droplevels(W1hous12HH),
W1hiqualmum = droplevels(W1hiqualmum),
W1marstatmum = droplevels(W1marstatmum)
)
#summary(merged_data)
sig.var_2 <- c("W1hea2MP", "W1NoldBroHS", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W8TENURE", "W2ghq12scr", "W4schatYP")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_2, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.2 <- lm(formula_obj, data = merged_data)
display(model.2)
sig.var_3 <- c("W1hea2MP", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6Apprent1YP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_3, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.3 <- lm(formula_obj, data = merged_data)
display(model.3)
sig.var_4 <- c("W1hea2MP", "W1hous12HH", "W1hiqualmum", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(sig.var_4, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.4 <- lm(formula_obj, data = merged_data)
#display(model.4)
vif(model.4)
kept_var <- c("W1hea2MP", "W1hous12HH", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.5 <- lm(formula_obj, data = merged_data)
display(model.5)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W6NEETAct", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.6 <- lm(formula_obj, data = merged_data)
display(model.6)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.7 <- lm(formula_obj, data = merged_data)
display(model.7) # the final model in this section
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.8 <- lm(formula_obj, data = merged_data)
display(model.8)
merged_data <- merged_data %>%
mutate(
W1depkids = as.character(W1depkids),
W1depkids = if_else(W1depkids %in% c("1", "2", "3"), "1_2_3", W1depkids),
W1nssecfam = as.character(W1nssecfam),
W1nssecfam = case_when(
W1nssecfam %in% c("1", "2") ~ "1_2",
W1nssecfam %in% c("3", "4", "5") ~ "3_4_5",
W1nssecfam %in% c("6", "7") ~ "6_7",
TRUE ~ as.character(W1nssecfam)
),
W1ethgrpYP = as.character(W1ethgrpYP),
W1ethgrpYP = case_when(
W1ethgrpYP %in% c("2", "3") ~ "2_3",
W1ethgrpYP %in% c("6", "7", "8") ~ "6_7_8",
TRUE ~ as.character(W1ethgrpYP)
),
W1hwndayYP = as.character(W1hwndayYP),
W1hwndayYP = if_else(W1hwndayYP %in% c("2", "3"), "2_3", W1hwndayYP)
) %>%
mutate(
# convert back to factors with new levels
W1depkids = factor(W1depkids),
W1nssecfam = factor(W1nssecfam),
W1ethgrpYP = factor(W1ethgrpYP),
W1hwndayYP = factor(W1hwndayYP)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1depkids = droplevels(W1depkids),
W1nssecfam = droplevels(W1nssecfam),
W1ethgrpYP = droplevels(W1ethgrpYP),
W1hwndayYP = droplevels(W1hwndayYP)
)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
display(model.9)
merged_data <- merged_data %>%
mutate(
W1depkids = as.character(W1depkids),
W1depkids = if_else(W1depkids %in% c("1", "2", "3"), "1_2_3", W1depkids),
W1nssecfam = as.character(W1nssecfam),
W1nssecfam = case_when(
W1nssecfam %in% c("1", "2") ~ "1_2",
W1nssecfam %in% c("3", "4", "5") ~ "3_4_5",
W1nssecfam %in% c("6", "7") ~ "6_7",
TRUE ~ as.character(W1nssecfam)
),
W1ethgrpYP = as.character(W1ethgrpYP),
W1ethgrpYP = case_when(
W1ethgrpYP %in% c("2", "3") ~ "2_3",
W1ethgrpYP %in% c("6", "7", "8") ~ "6_7_8",
TRUE ~ as.character(W1ethgrpYP)
),
W1hwndayYP = as.character(W1hwndayYP),
W1hwndayYP = if_else(W1hwndayYP %in% c("2", "3"), "2_3", W1hwndayYP)
) %>%
mutate(
# convert back to factors with new levels
W1depkids = factor(W1depkids),
W1nssecfam = factor(W1nssecfam),
W1ethgrpYP = factor(W1ethgrpYP),
W1hwndayYP = factor(W1hwndayYP)
)
# dropping unused factor levels
data <- data %>%
mutate(
W1depkids = droplevels(W1depkids),
W1nssecfam = droplevels(W1nssecfam),
W1ethgrpYP = droplevels(W1ethgrpYP),
W1hwndayYP = droplevels(W1hwndayYP)
)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1depkids", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.9 <- lm(formula_obj, data = merged_data)
summary(model.9)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.10 <- lm(formula_obj, data = merged_data)
summary(model.10)
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.10 <- lm(formula_obj, data = merged_data)
display(model.10)
summary(model.10)
par(mfrow=c(2,2))
plot(model.10,which=c(1,2))
hist(model.10$residuals,main="Histogram of residuals",font.main=1,xlab="Residuals")
par(mfrow=c(2,2))
plot(model.10,which=c(1,2))
hist(model.10$residuals,main="Histogram of residuals",font.main=1,xlab="Residuals")
show_outliers<-function(the.linear.model,topN){
#length of data
n=length(fitted(the.linear.model))
#number of parameters estimated
p=length(coef(the.linear.model))
#standardised residuals over 3
res.out<-which(abs(rstandard(the.linear.model))>3) #sometimes >2
#topN values
res.top<-head(rev(sort(abs(rstandard(the.linear.model)))),topN)
#high leverage values
lev.out<-which(lm.influence(the.linear.model)$hat>2*p/n)
#topN values
lev.top<-head(rev(sort(lm.influence(the.linear.model)$hat)),topN)
#high diffits
dffits.out<-which(dffits(the.linear.model)>2*sqrt(p/n))
#topN values
dffits.top<-head(rev(sort(dffits(the.linear.model))),topN)
#Cook's over 1
cooks.out<-which(cooks.distance(the.linear.model)>1)
#topN cooks
cooks.top<-head(rev(sort(cooks.distance(the.linear.model))),topN)
#Create a list with the statistics -- cant do a data frame as different lengths
list.of.stats<-list(Std.res=res.out,Std.res.top=res.top, Leverage=lev.out, Leverage.top=lev.top, DFFITS=dffits.out, DFFITS.top=dffits.top, Cooks=cooks.out,Cooks.top=cooks.top)
#return the statistics
list.of.stats}
#Get outliers
outliers <- show_outliers(model.10, topN = 5)
# Combine all outlier indices into a single vector
all_outliers <- unique(c(outliers$Std.res, outliers$Leverage, outliers$DFFITS, outliers$Cooks))
# Remove outliers from the dataset
cleaned_data <- merged_data[-all_outliers, ]
kept_var <- c("W1hea2MP", "W1marstatmum", "W1nssecfam", "W1ethgrpYP", "W1heposs9YP", "W1hwndayYP", "W1disabYP", "W2disc1YP", "W4CannTryYP", "W5JobYP", "W5EducYP", "W5Apprent1YP", "W6JobYP", "W6UnivYP", "W2ghq12scr")
#Create the formula string
formula_str <- paste("W8DINCW ~", paste(kept_var, collapse = " + "))
#Convert the string to a formula object
formula_obj <- as.formula(formula_str)
model.11 <- lm(formula_obj, data = cleaned_data)
display(model.11)
par(mfrow=c(2,2))
plot(model.11,which=c(1,2))
hist(model.11$residuals,main="Histogram of residuals",font.main=1,xlab="Residuals")
